<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <style>
    #toggleActiveFilter {
    width: 150px; /* Adjust the width as needed */
    padding: 0.25rem 0.5rem; /* Adjust padding for smaller button */
    font-size: 0.875rem; /* Smaller font size */
    text-align: center; /* Center the text */
}</style>

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ========================================aaaaaa================ -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="Adindex.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">IdCard</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">



        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="assets/img/profile-img.jpg" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2"><span id="userEmail"></span></span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6><span id="userEmail1"></span></h6>
              <span>Web Designer</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="ADusers-profile.html">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>


            <li>
              <hr class="dropdown-divider">
            </li>


            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="#" id="logoutBtn">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed" href="Adindex.html">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link " href="ADPaymentPortal.html">
          <i class="bi bi-credit-card"></i>
          <span>Payment portal</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Manage Retailer</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="ADforms-elements.html" >
              <i class="bi bi-circle"></i><span>Create retailer</span>
            </a>
          </li>
          <li>
            <a href="ADShowRetailer.html" >
              <i class="bi bi-circle"></i><span>Show retailer</span>
            </a>
          </li>
          <li>
            <a href="ADDeleteRetailer.html" >
              <i class="bi bi-circle"></i><span>Delete retailer</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#distributor-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Manage Distributor</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="distributor-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="ADCreateDIs.html" >
              <i class="bi bi-circle"></i><span>Create Distributor</span>
            </a>
          </li>
          <li>
            <a href="ADShowDis.html" >
              <i class="bi bi-circle"></i><span>Show Distributor</span>
            </a>
          </li>
          <li>
            <a href="ADDeleteDis.html" >
              <i class="bi bi-circle"></i><span>Delete Distributor</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#report-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-journal-text"></i><span>Manage Report</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="report-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="ADTokenReport.html" >
              <i class="bi bi-circle"></i><span>Overall Token Usage Report</span>
            </a>
          </li>
          <li>
            <a href="ADDistributorReport.html" >
              <i class="bi bi-circle"></i><span>Distributor Activity Report</span>
            </a>
          </li>
          <li>
            <a href="ADRetailerReport.html" >
              <i class="bi bi-circle"></i><span>Retailer Activity Summary</span>
            </a>
          </li>
          <li>
            <a href="ADDateSpecificReport.html" >
              <i class="bi bi-circle"></i><span>Date Range Filter</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed " data-bs-target="#Token-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-journal-text"></i><span>Manage Tokens</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="Token-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="ADToken.html">
              <i class="bi bi-circle"></i><span>Show Tokens</span>
            </a>
          </li>
          <li>
            <a href="ADTokenCreate.html">
              <i class="bi bi-circle"></i><span>Create Tokens</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-heading">Pages</li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="ADusers-profile.html">
          <i class="bi bi-person"></i>
          <span>Profile</span>
        </a>
      </li><!-- End Profile Page Nav -->
    </ul>
  </aside><!-- End Sidebar-->


  <main id="main" class="main">
    <!-- Modal Structure (Placed towards the bottom of the file) -->
    <div class="modal fade" id="notificationModal" tabindex="-1" role="dialog" aria-labelledby="notificationModalTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="notificationModalTitle">All Notifications</h5>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Notification items go here -->
            <div class="notification-item">
              <i class="bi bi-exclamation-circle text-warning"></i>
              <div>
                <h4>Lorem Ipsum</h4>
                <p>Quae dolorem earum veritatis oditseno</p>
                <p>30 min. ago</p>
              </div>
            </div>
            <hr class="dropdown-divider">
            <div class="notification-item">
              <i class="bi bi-x-circle text-danger"></i>
              <div>
                <h4>Atque rerum nesciunt</h4>
                <p>Quae dolorem earum veritatis oditseno</p>
                <p>1 hr. ago</p>
              </div>
            </div>
            <hr class="dropdown-divider">
            <div class="notification-item">
              <i class="bi bi-check-circle text-success"></i>
              <div>
                <h4>Sit rerum fuga</h4>
                <p>Quae dolorem earum veritatis oditseno</p>
                <p>2 hrs. ago</p>
              </div>
            </div>
            <hr class="dropdown-divider">
            <div class="notification-item">
              <i class="bi bi-info-circle text-primary"></i>
              <div>
                <h4>Dicta reprehenderit</h4>
                <p>Quae dolorem earum veritatis oditseno</p>
                <p>4 hrs. ago</p>
              </div>
            </div>
            <hr class="dropdown-divider">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- End Page Title -->

    <section class="section dashboard">
      <div class="page-content-wrapper p-xxl-4" style="height: auto !important; min-height: 0px !important;">
        <div class="row">
          <div class="pagetitle">
            <h1>
              <i class="bi bi-bank"> Add Money</i>
            </h1>
            <nav>
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="Adindex.html">Home</a></li>
                <li class="breadcrumb-item active">Payment portal</li>
              </ol>
            </nav>
          </div>
        </div>
        <ul class="nav nav-tabs nav-bottom-line mb-3 d-flex justify-content-center">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#tab-payment-gateway">
              Create token
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-qr-payment">
              Banks
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-other">
              Other
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-Status">
              Status
            </a>
          </li>
        </ul>
        <div class="tab-content mt-3" style="height: auto !important;">
          <div class="tab-pane show active" id="tab-payment-gateway" style="height: auto !important;">
            <div class="row g-4">
              <!-- Left Column: Token Card -->
              <div class="col-md-4 col-sm-6 col-lg-4 float-start">
                <div class="card info-card revenue-card">
                  <div class="card-body">
                    <h5 class="card-title">Token</h5>
                    <div class="d-flex align-items-center">
                      <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                        <i class="bi bi-currency-dollar"></i>
                      </div>
                      <div class="ps-3">
                        <h6 id="tokenCount">0</h6>
                      </div>
                    </div>
                  </div>
                </div><!-- End Token Card -->
              </div>



              <div class="col-md-6 col-sm-12 col-lg-6 mx-auto">
              <div class="card">
                  <div class="border-bottom card-header">
                    <div class="mb-0 card-title h5">
                      Create</div>
                    <p class="mb-0 small">
                      Create tokens from here
                    </p>
                  </div>
                  <div class="card-body">
                    <form>
                      <div class="mb-3">
                        <label for="inputAmount" class="col-sm-2 col-form-label">Amount</label>
                        <div class="col-sm-10">
                          <input type="number" class="form-control" id="inputAmount" placeholder="Enter Token Amount" required>
                        </div>
                      </div>
                      <div class="d-grid mt-4">
                        <!-- Button Triggering Token Creation -->
                        <button type="button" class="btn btn-dark d-flex justify-content-center align-items-center" id="createTokenButton">
                          <span class="fs-5 me-2">✨ Create Tokens</span>
                        </button>
                      </div>

                      <!-- Alert Message (Optional for displaying raw message) -->
                      <div id="tokenCreationMessage" class="mt-3"></div>
                    </form>

                    <!-- Payment Modal -->
                    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-body text-center">
                            <!-- Modal Header Text -->
                            <p class="text-muted small mb-4">Open your UPI app and scan the QR code below to PAY the amount:</p>

                            <!-- QR Code Container -->
                            <div class="d-flex justify-content-center mb-4">
                              <div id="qrcode"></div>
                            </div>

                            <!-- Scan QR Text -->
                            <p class="text-muted small mb-4">Scan QR</p>

                            <!-- Transaction Code Input -->
                            <p class="text-muted small mb-2">If payment is done, enter the transaction code below:</p>
                            <input type="text" id="transactionID" class="form-control mb-3" placeholder="Transaction ID">

                            <!-- Done Button -->
                            <button type="button" class="btn btn-dark" id="doneButton">Done</button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Bootstrap Alert (Initially Hidden) -->
                    <div id="paymentAlert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
                      <span id="alertMessage"></span>
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-4 mt-4" style="height: auto !important;">
            </div>
          </div>
          <div class="tab-pane" id="tab-qr-payment">
            <div class="row g-4">
              <div class="col-md-8 mx-auto">
                <div class="card">
                  <div class="border-bottom card-header">
                    <div class="mb-0 card-title h5">Modify Accounts</div>
                    <p class="mb-0 small">Add or Remove Bank Accounts.</p>
                  </div>
                  <div class="card-body">
                    <!-- Bank Details Section -->
                    <!-- Bootstrap Alert -->
                    <div id="alertContainer" class="alert d-none" role="alert"></div>
                    <!-- Show Active Button -->
                    <div class="d-grid mt-2">
                      <button type="button" id="toggleActiveFilter" class="btn btn-dark btn-sm" onclick="filterActiveAccounts()">
                        <span class="fs-6 me-2" id="buttonText">Show Active <i class="bi bi-arrow-down"></i></span>
                      </button>
                    </div>
                    <div class="container mt-4">
                      <h6 class="text-muted"><i class="bi bi-bank"></i> Account Details (Active)</h6>

                      <div style="max-height: 300px; overflow-y: auto;"> <!-- Scrollable container -->
                        <table class="table table-striped">
                          <thead>
                          <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Account Type</th>
                            <th scope="col">Identifier</th>
                            <th scope="col">Name</th>
                            <th scope="col">Actions</th>
                          </tr>
                          </thead>
                          <tbody id="accountTableBody">
                          <!-- Table rows will be injected here -->
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid mt-4">
                      <button type="button" class="btn btn-dark d-flex justify-content-center align-items-center" data-bs-toggle="modal" data-bs-target="#addBankModal">
                        <span class="fs-5 me-2">✨ Add Bank</span>
                        <img src="assets/img/bank.png" style="height: 20px; width: auto;" alt="Bank">
                      </button>
                      <button type="button" class="btn btn-danger d-flex justify-content-center align-items-center" data-bs-toggle="modal" data-bs-target="#addUpiModal">
                        <span class="fs-5 me-2">✨ Add UPI Account</span>
                        <img src="assets/img/upi.svg" style="height: 20px; width: auto;" alt="Upi">
                      </button>
                      <!--                    <button type="button" class="btn btn-warning d-flex justify-content-center align-items-center" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">-->
                      <!--                      <span class="fs-5 me-2">✨ Delete Accounts</span>-->
                      <!--                      <img src="assets/img/upi.svg" style="height: 20px; width: auto;" alt="UPI">-->
                      <!--                      <img src="assets/img/bank.png" style="height: 20px; width: auto;" alt="Bank">-->
                      <!--                    </button>-->
                    </div>

                    <!-- Deactivate Confirmation Modal -->
                    <div class="modal fade" id="deactivateModal" tabindex="-1" aria-labelledby="deactivateModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="deactivateModalLabel">Confirm Deactivation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            Are you sure you want to activate this account? This will deactivate any currently active account of the same type.
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="activateAccount()">Activate</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Add Bank Modal -->
                    <!-- Add Bank Modal -->
                    <div class="modal fade" id="addBankModal" tabindex="-1" aria-labelledby="addBankModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="addBankModalLabel">Add Bank Account</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <form id="addBankForm">
                              <div class="row">
                                <!-- Bank Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="bankName" class="form-label">Bank Name</label>
                                  <input type="text" class="form-control" id="bankName" required>
                                </div>

                                <!-- Account Number -->
                                <div class="col-md-6 mb-3">
                                  <label for="accountNumber" class="form-label">Account Number</label>
                                  <input type="text" class="form-control" id="accountNumber" required>
                                </div>
                              </div>

                              <div class="row">
                                <!-- Re-enter Account Number -->
                                <div class="col-md-6 mb-3">
                                  <label for="reAccountNumber" class="form-label">Re-enter Account Number</label>
                                  <input type="text" class="form-control" id="reAccountNumber" required>
                                </div>

                                <!-- Account Owner Full Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="accountOwner" class="form-label">Account Owner Full Name</label>
                                  <input type="text" class="form-control" id="accountOwner" required>
                                </div>
                              </div>

                              <div class="row">
                                <!-- Father's Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="fathersName" class="form-label">Father's Name</label>
                                  <input type="text" class="form-control" id="fathersName" required>
                                </div>

                                <!-- Mother's Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="mothersName" class="form-label">Mother's Name</label>
                                  <input type="text" class="form-control" id="mothersName" required>
                                </div>
                              </div>

                              <div class="row">
                                <!-- Address -->
                                <div class="col-md-6 mb-3">
                                  <label for="address" class="form-label">Address</label>
                                  <input type="text" class="form-control" id="address" required>
                                </div>

                                <!-- IFSC Code -->
                                <div class="col-md-6 mb-3">
                                  <label for="ifscCode" class="form-label">IFSC Code</label>
                                  <input type="text" class="form-control" id="ifscCode" required>
                                </div>
                              </div>
                              <!-- Use type="button" instead of "submit" -->
                              <button type="button" id="addBankBtn" class="btn btn-dark">Add Account</button>

                              <!-- Small Text -->
                              <p class="text-center text-muted small mt-3">We support all payment methods.</p>

                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Success Modal -->
                    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                          <div class="modal-body text-center">
                            <img src="assets/img/success.png" alt="Success" style="width: 100px; margin-bottom: 20px;">
                            <h4>Account has been saved successfully!</h4>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Error Modal -->
                    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                          <div class="modal-body text-center">
                            <h4 class="text-danger">Error</h4>
                            <p id="errorModalBody"></p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Add UPI Modal -->
                    <div class="modal fade" id="addUpiModal" tabindex="-1" aria-labelledby="addUpiModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <!-- Modal Header -->
                          <div class="modal-header">
                            <h5 class="modal-title" id="addUpiModalLabel">Add UPI Account</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>

                          <!-- Modal Body -->
                          <div class="modal-body">
                            <p class="text-muted">Please enter your UPI account details</p>
                            <form id="addUpiForm" enctype="multipart/form-data">
                              <div class="row">
                                <!-- UPI ID -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiId" class="form-label">Enter UPI ID</label>
                                  <input type="text" class="form-control" id="upiId" required>
                                </div>

                                <!-- Account Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiAccountName" class="form-label">Account Name</label>
                                  <input type="text" class="form-control" id="upiAccountName" required>
                                </div>
                              </div>

                              <div class="row">
                                <!-- Father's Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiFathersName" class="form-label">Father's Name</label>
                                  <input type="text" class="form-control" id="upiFathersName" required>
                                </div>

                                <!-- Mother's Name -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiMothersName" class="form-label">Mother's Name</label>
                                  <input type="text" class="form-control" id="upiMothersName" required>
                                </div>
                              </div>

                              <div class="row">
                                <!-- Address -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiAddress" class="form-label">Address</label>
                                  <input type="text" class="form-control" id="upiAddress" required>
                                </div>

                                <!-- QR Code Upload -->
                                <div class="col-md-6 mb-3">
                                  <label for="upiQrCode" class="form-label">Upload QR Code(Optional)</label>
                                  <input type="file" class="form-control" id="upiQrCode" accept="image/*">
                                </div>
                              </div>

                              <!-- Add UPI Account Button -->
                              <div class="d-grid">
                                <button type="submit" class="btn btn-dark">Add UPI Account</button>
                              </div>

                              <p class="text-center text-muted small mt-3">We support all payment methods.</p>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Alerts  Modal -->
                    <div id="alertPlaceholder"></div>
                    <!-- Delete Account Modal -->
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="deleteConfirmationLabel">Confirm Delete</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            Are you sure you want to delete <span id="accountToDelete"></span>?
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="confirmDeleteButton">Delete</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Edit Account Modal -->
                    <div class="modal fade" id="editAccountModal" tabindex="-1" aria-labelledby="editAccountModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <!-- Modal Header -->
                          <div class="modal-header">
                            <h5 class="modal-title" id="editAccountModalLabel">Edit Account</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>

                          <!-- Modal Body -->
                          <div class="modal-body">
                            <form id="editAccountForm">
                              <div class="mb-3">
                                <label for="editIdentifier" class="form-label">Identifier</label>
                                <input type="text" class="form-control" id="editIdentifier" required>
                              </div>
                              <div class="mb-3">
                                <label for="editName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="editName" required>
                              </div>
                            </form>
                          </div>

                          <!-- Modal Footer -->
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" onclick="saveChanges()">Save changes</button>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="tab-other">
            <div class="row g-4">
              <div class="col-md-6 mx-auto">
                <div class="border shadow card">
                  <div class="border-bottom card-header">
                    <h5 class="card-header-title">
                      Add Gift Card
                    </h5>
                    <p class="mb-0 small">Currently this service is not available</p>
                  </div>
                  <form class="needs-validation">
                    <div class="card-body">
                      <div class="mb-3">
                        <label class="form-label" for="giftcard">Gift Card Number</label>
                        <input placeholder="Gift Card Number" name="giftcard" required="" type="text" id="giftcard" class="form-control">
                        <div class="invalid-feedback">
                        </div>
                      </div>
                    </div>
                    <div class="border-top card-footer">
                      <div class="text-center">
                        <button type="submit" class="btn btn-primary fs-5 me-3">
                        <span class="spinner-border spinner-border-sm me-2" aria-hidden="true" style="display: none;">

                        </span>
                          <span>Submit</span>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>


          <!----------------------------------Status table ------------------------->
          <div class="tab-pane" id="tab-Status">
            <div class="row g-4">
              <div class="col-md-10 mx-auto">
                <div class="border shadow card">
                  <div class="border-bottom card-header">
                    <h5 class="card-header-title">
                      Status
                    </h5>
                    <p class="mb-0 small">Status table</p>
                  </div>
                  <div class="card-body">
                    <!-- Search and Refresh Controls -->
                    <div class="d-flex justify-content-between mb-3">
                      <input type="text" id="searchTransactionId" class="form-control" placeholder="Search by Transaction ID">
                      <button id="refreshButton" class="btn btn-primary">Refresh</button>
                    </div>
                    <!-- Table -->
                    <table class="table table-sm">
                      <thead>
                      <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Transaction ID</th>
                        <th>Type</th> <!-- New Type Column -->
                      </tr>
                      </thead>
                      <tbody id="transactionTableBody">
                      <!-- Table rows will be inserted here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>



    </section>


  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>Idcard</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      <!-- All the links in the footer should remain intact. -->
      <!-- You can delete the links only if you purchased the pro version. -->
      <!-- Licensing information: https://bootstrapmade.com/license/ -->
      <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
      Designed by <a href="https://scriza.in/">Scriza</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Add this in your <head> section or before the closing </body> tag -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Template Main JS File -->
<!--  <script src="assets/js/main.js"></script>-->
  <script>
//---------------------table apis-----------------------
    document.addEventListener('DOMContentLoaded', function () {
  const userEmail = sessionStorage.getItem('userEmail'); // Fetch session storage userEmail
  const transactionTableBody = document.getElementById('transactionTableBody');
  const searchInput = document.getElementById('searchTransactionId');
  const refreshButton = document.getElementById('refreshButton');
  const tokenPlanMap = {
    22: 10,
    55: 25,
    110: 50,
    220: 100,
    385: 175,
    550: 250,
    1100: 500
  };

  // Fetch and display transactions
  function fetchAndDisplayTransactions() {
    fetch(`http://localhost:8080/api/admin/distributor/getTransactionRequests?creatorEmail=${userEmail}&userEmail=${userEmail}`)
      .then(response => response.json())
      .then(data => {
        transactionTableBody.innerHTML = ''; // Clear the table body

        // Filter the data based on search input
        const filteredData = data.filter(transaction =>
          !searchInput.value || transaction.transactionId.includes(searchInput.value)
        );

        filteredData.forEach((transaction, index) => {
          // Determine the request type based on the current user
          let type = '';
          if (transaction.userEmail === userEmail) {
            type = 'Request Sent';
          } else if (transaction.creatorEmail === userEmail) {
            type = 'Request Received';
          }

          // Format the date (remove time)
          const date = new Date(transaction.timestamp).toLocaleDateString();

          // Determine the status image based on transaction status
          let statusImage = '';
          switch (transaction.status) {
            case 'Pending':
              statusImage = 'assets/img/pending.png';
              break;
            case 'Rejected':
              statusImage = 'assets/img/rejected.png';
              break;
            case 'Accepted':
              statusImage = 'assets/img/success.png';
              break;
            default:
              statusImage = 'assets/img/default.png'; // Fallback image
          }

          // Create a table row
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${date}</td>
              <td>${Math.round(transaction.amount)}</td>
              <td><img src="${statusImage}" alt="${transaction.status}" style="height: 20px;"></td>
              <td>${transaction.transactionId}</td>
              <td>${type}</td>
              <td>
                ${transaction.status === 'Pending' && type === 'Request Received' ? `
                  <button class="btn btn-sm btn-success me-2" onclick="updateStatusAndSendToken('${transaction.transactionId}', 'Accepted', ${transaction.amount}, '${transaction.userEmail}')">Accept</button>
                  <button class="btn btn-sm btn-danger" onclick="updateStatus('${transaction.transactionId}', 'Rejected')">Reject</button>
                ` : ''}
              </td>
            </tr>
          `;
          transactionTableBody.innerHTML += row;
        });
      })
      .catch(error => console.error('Error fetching transaction requests:', error));
  }

  // Function to update transaction status (only refresh table and show alert)
window.updateStatus = function (transactionId, status) {
  fetch(`http://localhost:8080/api/admin/distributor/updateTransactionStatus?transactionId=${transactionId}&status=${status}`, {
    method: 'POST'
  })
    .then(response => response.json())
    .then(data => {
      if (data.message) {
        // Display an alert for successful update (accepted or rejected)
        Swal.fire({
          icon: 'success',
          title: 'Success',
          text: `Transaction ${status.toLowerCase()} successfully!`,
          confirmButtonText: 'OK'
        }).then(() => {
          // Refresh the table after the status update
          fetchAndDisplayTransactions();
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: data.error || 'An error occurred',
          confirmButtonText: 'OK'
        });
      }
    })
    .catch(error => {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'An error occurred while updating the status',
        confirmButtonText: 'OK'
      });
      console.error('Error:', error);
    });
}
  // Function to update transaction status and send tokens
  window.updateStatusAndSendToken = function (transactionId, status, amount, recipientEmail) {
    // First update the status
    fetch(`http://localhost:8080/api/admin/distributor/updateTransactionStatus?transactionId=${transactionId}&status=${status}`, {
      method: 'POST'
    })
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          // After status is updated, send the token
          const tokenAmount = tokenPlanMap[amount];
          return fetch(`http://localhost:8080/api/admin/token/send?senderIdentifier=${userEmail}&amount=${tokenAmount}&recipient=${recipientEmail}`, {
            method: 'POST'
          });
        } else {
          throw new Error(data.error || 'An error occurred while updating the status');
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          Swal.fire({
            icon: 'success',
            title: 'Success',
            text: 'Token sent successfully!',
            confirmButtonText: 'OK'
          }).then(() => {
            fetchAndDisplayTransactions(); // Refresh the table after sending tokens
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: data.error || 'An error occurred while sending the token',
            confirmButtonText: 'OK'
          });
        }
      })
      .catch(error => {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: error.message || 'An error occurred',
          confirmButtonText: 'OK'
        });
        console.error('Error:', error);
      });
  };

  // Fetch transactions on page load
  fetchAndDisplayTransactions();

  // Refresh button event listener
  refreshButton.addEventListener('click', fetchAndDisplayTransactions);

  // Search input event listener
  searchInput.addEventListener('input', fetchAndDisplayTransactions);
});
    //  ------------------------------Create transection request api------------------------------------------

    document.addEventListener("DOMContentLoaded", function() {
      const doneButton = document.getElementById("doneButton");

      doneButton.addEventListener("click", function() {
        const transactionID = document.getElementById("transactionID").value;
        const amount = document.getElementById("selectPlan").value;
        const email = sessionStorage.getItem('userEmail'); // Replace with the actual session email value

        if (!transactionID) {
          alert("Please enter the transaction ID.");
          return;
        }

        fetch(`http://localhost:8080/api/admin/distributor/createTransactionRequest?email=${email}&amount=${amount}&transactionId=${transactionID}`, {
          method: 'POST'
        })
          .then(response => response.json())
          .then(data => {
          if (data.message) {
            showAlert("Payment request submitted successfully.");
          } else {
            showAlert("Error: " + (data.error || "Unknown error"));
          }
        })
          .catch(error => {
          showAlert("Error: " + error.message);
        });
      });

      function showAlert(message) {
        const alert = document.getElementById("paymentAlert");
        const alertMessage = document.getElementById("alertMessage");
        alertMessage.textContent = message;
        alert.classList.remove("d-none");
      }
    });
    //----------------------------------User name Api -----------------------------------

    document.addEventListener("DOMContentLoaded", function() {
      // Function to fetch the user's name from the API
      function fetchUserName() {
        // Get the email from session data
        const email = sessionStorage.getItem('userEmail'); // Ensure this is how you fetch email from the session

        if (email) {
          fetch(`http://localhost:8080/api/admin/distributor/name?email=${encodeURIComponent(email)}`)
            .then(response => response.json())
            .then(data => {
            const userName = data.name || 'Guest'; // Use 'Guest' if no name is found
            // Update the HTML elements with the fetched name
            document.querySelector('.nav-profile .dropdown-toggle').textContent = userName;
            document.querySelector('.dropdown-header h6').textContent = userName;
          })
            .catch(error => {
            console.error('Error fetching name:', error);
            // Fallback to 'Guest' in case of an error
            document.querySelector('.nav-profile .dropdown-toggle').textContent = 'Guest';
            document.querySelector('.dropdown-header h6').textContent = 'Guest';
          });
        } else {
          console.error('No email found in session.');
          // Fallback to 'Guest' if email is missing
          document.querySelector('.nav-profile .dropdown-toggle').textContent = 'Guest';
          document.querySelector('.dropdown-header h6').textContent = 'Guest';
        }
      }

      // Call the function on page load
      fetchUserName();
    });
    //--------------------------------Logout api ----------------------
    document.addEventListener("DOMContentLoaded", function() {
      // Add event listener to the logout button
      document.getElementById('logoutBtn').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default link behavior
        sessionStorage.clear(); // Clear session storage
        window.location.href = '/login.html'; // Redirect to login page or any other page
      });
    });

    //---------------------------------- Alert & gneerate QR code Function  ----------------------------------
    function generateQRCode() {
      // Get the selected plan amount
      var amount = document.getElementById('selectPlan').value;

      // Receiver's UPI ID
      var upiID = "ritiksoni101@ybl";

      // Construct the UPI Payment URL
      var upiUrl = `upi://pay?pa=${upiID}&pn=Ritik&am=${amount}&cu=INR`;

      // Clear any previous QR code
      document.getElementById("qrcode").innerHTML = "";

      // Generate the QR Code
      var qrcode = new QRCode(document.getElementById("qrcode"), {
        text: upiUrl,
        width: 200,  // QR Code width
        height: 200, // QR Code height
      });
    }

    // Event listener for Done button
    document.getElementById('doneButton').addEventListener('click', function() {
      // Get the selected plan text
      var selectedPlan = document.querySelector('select[name="amount"] option:checked').textContent;

      // Get the transaction ID
      var transactionID = document.getElementById('transactionID').value;

      // Validate transaction ID input
      if (transactionID === '') {
        alert('Please enter the transaction ID.');
        return;
      }

      // Construct the alert message
      var alertMessage = `Your request for the <strong>${selectedPlan}</strong> has been sent. Please wait while we process. Or check your status from <a href="ADTokenReport.html" class="alert-link">here</a>.`;

      // Display the alert with the message
      document.getElementById('alertMessage').innerHTML = alertMessage;
      document.getElementById('paymentAlert').classList.remove('d-none');

      // Hide the modal
      var paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
      paymentModal.hide();
    });



    // ------------------------------------------ Account API ----------------------------------------------------------
    const userEmail = sessionStorage.getItem('userEmail');
 let selectedAccountId = null; // Variable to hold the currently selected account ID
 let currentIdentifier = ''; // To store the current identifier
 let currentName = ''; // To store the current name

 // Function to fetch API data and populate the table
 function fetchAndDisplayAccounts() {
     fetch(`http://localhost:8080/api/admin/bank/view?email=${userEmail}`)
         .then(response => response.json())
         .then(data => {
             const tableBody = document.getElementById('accountTableBody');
             tableBody.innerHTML = ''; // Clear existing rows

             data.forEach(account => {
                 const row = document.createElement('tr');

                 // Determine account type and status
                 let accountType = account.identifier
                     ? account.identifier.includes('@') ? 'UPI Account' : 'Bank Account'
                     : 'Unknown';

                 const identifier = account.identifier || 'N/A';
                 const name = account.name || 'N/A';
                 const status = account.status || 'N/A';
                 const statusButton = status === 'ACTIVE'
                     ? `<button class="btn btn-success btn-sm" disabled>Active</button>`
                     : `<button class="btn btn-dark btn-sm" onclick="openDeactivateModal('${identifier}')">Deactivate</button>`;

                 row.innerHTML = `
                     <td>${account.id}</td>
                     <td>${accountType}</td>
                     <td>${identifier}</td>
                     <td>${name}</td>
                     <td>
                       <button class="btn btn-warning btn-sm" onclick="openEditModal(${account.id}, '${identifier}', '${name}')">Edit</button>
                       <button class="btn btn-danger btn-sm" onclick="deleteAccount('${account.id}', '${identifier}')">Delete</button>
                       ${statusButton}
                     </td>
                 `;

                 tableBody.appendChild(row);
             });
         })
         .catch(error => {
             console.error('Error fetching accounts:', error);
         });
 }

 // Function to open the edit modal and populate fields
 function openEditModal(id, identifier, name) {
     selectedAccountId = id; // Store the current account ID for reference
     currentIdentifier = identifier;
     currentName = name;

     // Set modal input fields with current values
     document.getElementById('editIdentifier').value = identifier;
     document.getElementById('editName').value = name;

     const editModal = new bootstrap.Modal(document.getElementById('editAccountModal'));
     editModal.show();
 }

 // Function to save changes and call the API
 function saveChanges() {
     const newIdentifier = document.getElementById('editIdentifier').value;
     const newName = document.getElementById('editName').value;

     let changeIdentifier = '';
     let changeName = '';

     let isIdentifierChanged = false;
     let isNameChanged = false;

     // Check if the identifier was changed
     if (newIdentifier !== currentIdentifier) {
         changeIdentifier = newIdentifier; // Send new identifier to API
         isIdentifierChanged = true;
     }

     // Check if the name was changed
     if (newName !== currentName) {
         changeName = newName; // Send new name to API
         isNameChanged = true;
     }

     // If neither identifier nor name was changed, exit the function
     if (!isIdentifierChanged && !isNameChanged) {
         showAlert('warning', 'No changes were made.');
         return;
     }

     // Prepare the API URL with the parameters for both changes
     let apiUrl = `http://localhost:8080/api/admin/bank/modify?email=${userEmail}&identifier=${currentIdentifier}`;

     // Append parameters conditionally based on what was changed
     if (isIdentifierChanged) {
         apiUrl += `&changeIdentifier=${encodeURIComponent(changeIdentifier)}`;
     }
     if (isNameChanged) {
         apiUrl += `&changeName=${encodeURIComponent(changeName)}`;
     }

     fetch(apiUrl, {
         method: 'PUT',
         headers: {
             'Content-Type': 'application/json'
         }
     })
         .then(response => response.json())
         .then(data => {
             if (data.status === 'success') {
                 // Show success message based on what was changed
                 let successMessage = '';
                 if (isIdentifierChanged && isNameChanged) {
                     successMessage = 'Identifier and Name have been successfully changed.';
                 } else if (isIdentifierChanged) {
                     successMessage = 'Identifier has been successfully changed.';
                 } else if (isNameChanged) {
                     successMessage = 'Name has been successfully changed.';
                 }

                 showAlert('success', successMessage);
                 fetchAndDisplayAccounts(); // Refresh the account table

                 const editModal = bootstrap.Modal.getInstance(document.getElementById('editAccountModal'));
                 editModal.hide(); // Close the modal
             } else {
                 showAlert('danger', 'Failed to modify the account.');
             }
         })
         .catch(error => {
             console.error('Error modifying account:', error);
             showAlert('danger', 'An error occurred while modifying the account.');
         });
 }

 // Function to open the deactivate confirmation modal
function openDeactivateModal(identifier) {
    console.log('Opening deactivate modal with identifier:', identifier); // Debugging
    selectedAccountId = identifier;
    const deactivateModal = new bootstrap.Modal(document.getElementById('deactivateModal'));
    deactivateModal.show();
}

 // Function to activate the account after confirmation
 function activateAccount() {
     fetch(`http://localhost:8080/api/admin/bank/updateStatus?email=${userEmail}&identifier=${selectedAccountId}&status=ACTIVE`, {
         method: 'POST',
         headers: {
             'Content-Type': 'application/json'
         }
     })
     .then(response => response.text()) // Change to .text() to handle plain text response
     .then(text => {
         if (text === 'Bank status updated successfully') {
             showAlert('success', 'Account has been activated.');
             fetchAndDisplayAccounts(); // Refresh the account table

             // Hide the confirmation modal
             const deactivateModal = bootstrap.Modal.getInstance(document.getElementById('deactivateModal'));
             deactivateModal.hide();
         } else {
             showAlert('danger', 'Failed to activate the account.');
         }
     })
     .catch(error => {
         console.error('Error activating account:', error);
         showAlert('danger', 'An error occurred while activating the account.');
     });
 }


 // Function to show alerts using SweetAlert
 function showAlert(type, message) {
     Swal.fire({
         icon: type,
         title: message,
         showConfirmButton: true,
         timer: 3000
     });
 }
    // ---------------------------- Delete API -------------------------------
    // Variable to hold the account details for deletion
    let currentDeleteAccountIdentifier = null;

    // Function to trigger the delete confirmation modal
    function deleteAccount(id, identifier) {
      currentDeleteAccountIdentifier = identifier;

      // Set the account to delete in the confirmation modal
      document.getElementById('accountToDelete').innerText = identifier;

      // Show the delete confirmation modal
      const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
      deleteModal.show();
    }

    // Function to handle the actual deletion
    function handleDelete() {
      const userEmail = sessionStorage.getItem('userEmail');
      const apiUrl = `http://localhost:8080/api/admin/bank/delete?email=${userEmail}&identifier=${currentDeleteAccountIdentifier}`;

      fetch(apiUrl, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => response.text())
        .then(data => {
        if (data.includes('Bank deleted successfully')) {
          // Show success alert
          showAlert('success', 'Bank deleted successfully');
          fetchAndDisplayAccounts(); // Refresh the account table
        } else {
          // Show error alert
          showAlert('danger', 'Failed to delete the account');
        }

        // Hide the delete confirmation modal
        const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
        deleteModal.hide();
      })
        .catch(error => {
        console.error('Error deleting account:', error);
        showAlert('danger', 'An error occurred while deleting the account');
      });
    }

    // Function to setup the delete button listener
    function setupDeleteButtonListener() {
      const confirmDeleteButton = document.getElementById('confirmDeleteButton');
      if (confirmDeleteButton) {
        confirmDeleteButton.addEventListener('click', handleDelete);
        console.log('Delete button listener set up successfully.');
      } else {
        console.error('Confirm Delete Button not found.');
      }
    }

    // Ensure event listeners are added once the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
      setupDeleteButtonListener();
      fetchAndDisplayAccounts(); // Load the table when the page loads
    });

    // Function to display Bootstrap alerts
    function showAlert(type, message) {
      const alertContainer = document.getElementById('alertContainer');
      alertContainer.className = `alert alert-${type}`;
      alertContainer.textContent = message;
      alertContainer.classList.remove('d-none'); // Show the alert

      // Automatically hide the alert after 5 seconds
      setTimeout(() => {
        alertContainer.classList.add('d-none');
      }, 5000);
    }
    //---------------------------------------------Sort Active button ---------------------------
    let isFilterActive = false;

function filterActiveAccounts() {
    // Get all table rows
    const rows = document.querySelectorAll('#accountTableBody tr');
    const button = document.getElementById('toggleActiveFilter');

    rows.forEach(row => {
        // Check if the Actions column contains an "Active" button
        const actionsCell = row.querySelector('td:last-child');
        if (actionsCell) {
            const buttons = actionsCell.querySelectorAll('button');
            let showRow = false;

            // Check if there is an "Active" button
            buttons.forEach(button => {
                if (button.textContent.trim() === 'Active') {
                    showRow = true;
                }
            });

            // Show or hide the row based on the presence of the "Active" button
            if (isFilterActive) {
                row.style.display = ''; // Show the row
            } else {
                if (showRow) {
                    row.style.display = ''; // Show the row
                } else {
                    row.style.display = 'none'; // Hide the row
                }
            }
        }
    });

    // Toggle filter state and update button text
    isFilterActive = !isFilterActive;
    button.innerHTML = isFilterActive ?
        '<span class="fs-6 me-2" id="buttonText">Show All <i class="bi bi-arrow-up"></i></span>' :
        '<span class="fs-6 me-2" id="buttonText">Show Active <i class="bi bi-arrow-down"></i></span>';
}

    //---------------------------------------------Add Bank Account ---------------------------
    document.addEventListener('DOMContentLoaded', function () {
      const addBankForm = document.getElementById('addBankForm');
      const addBankBtn = document.getElementById('addBankBtn');

      if (addBankForm && addBankBtn) {
        // Listen for the button click
        addBankBtn.addEventListener('click', function () {
          console.log('Button clicked!'); // Check if the button click is registered

          // Retrieve email from session storage
          const email = sessionStorage.getItem('userEmail');
          if (!email) {
            console.error('Email not found in session storage.');
            showErrorModal("User email not found.");
            return;
          }

          // Gather form data
          const accountNumber = document.getElementById('accountNumber').value.trim();
          const reAccountNumber = document.getElementById('reAccountNumber').value.trim();
          const accountOwnerFullName = document.getElementById('accountOwner').value.trim();
          const fathersName = document.getElementById('fathersName').value.trim();
          const mothersName = document.getElementById('mothersName').value.trim();
          const address = document.getElementById('address').value.trim();
          const ifscCode = document.getElementById('ifscCode').value.trim();

          // Validate account number match
          if (accountNumber !== reAccountNumber) {
            console.error('Account numbers do not match.');
            showErrorModal("Account numbers do not match.");
            return;
          }

          // Validate required fields
          if (!accountNumber || !accountOwnerFullName || !fathersName || !mothersName || !address || !ifscCode) {
            console.error('All fields are required.');
            showErrorModal("All fields are required.");
            return;
          }

          // Create the request body
          const requestBody = new URLSearchParams({
            email: email,
            accountNumber: accountNumber,
            reEnterAccountNumber: reAccountNumber,
            accountOwnerFullName: accountOwnerFullName,
            fathersName: fathersName,
            mothersName: mothersName,
            address: address,
            ifscCode: ifscCode
          });

          console.log('Request body:', requestBody.toString()); // Debugging log

          // Send the POST request to the API
          fetch('http://localhost:8080/api/admin/bank/save', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: requestBody
          })
            .then(response => response.text()) // Convert to text to match the response format
            .then(data => {
            console.log('Response data:', data); // Debugging log
            if (data === "Bank saved successfully") {
              showSuccessModal();
              addBankForm.reset(); // Optionally reset the form after successful submission
            } else {
              showErrorModal("Error: " + data);
            }
          })
            .catch(error => {
            console.error('Error:', error); // Debugging log
            showErrorModal("An error occurred while saving the bank.");
          });
        });
      } else {
        console.error('addBankForm or addBankBtn element not found.');
      }

      // Show success modal
      function showSuccessModal() {
        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
        successModal.show();

        // Optionally, refresh the page or reload the table after closing the modal
        successModal._element.addEventListener('hidden.bs.modal', function () {
          location.reload(); // Refresh the page after closing
        });
      }

      // Show error modal
      function showErrorModal(errorMessage) {
        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        document.getElementById('errorModalBody').innerText = errorMessage;
        errorModal.show();
      }
    });
    //---------------------------------Add Upi account apis--------------------------------------
    document.getElementById('addUpiForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const formData = new FormData();
      const email = sessionStorage.getItem('userEmail');
      formData.append('email', email);
      formData.append('upiId', document.getElementById('upiId').value);
      formData.append('upiName', document.getElementById('upiAccountName').value);
      formData.append('upiFathersName', document.getElementById('upiFathersName').value);
      formData.append('upiMothersName', document.getElementById('upiMothersName').value);
      formData.append('upiProvider', 'Some UPI Provider'); // Example provider
      formData.append('address', document.getElementById('upiAddress').value);

      // Append the QR Code file
      const qrCodeFile = document.getElementById('upiQrCode').files[0];
      if (qrCodeFile) {
        formData.append('qrCodeFile', qrCodeFile);
      }

      fetch('http://localhost:8080/api/admin/bank/save', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        if (data.includes('Bank saved successfully')) {
          // Show success alert and close modal
          showAlert('success', 'Bank saved successfully');
          const addUpiModal = bootstrap.Modal.getInstance(document.getElementById('addUpiModal'));
          addUpiModal.hide();
          fetchAndDisplayAccounts(); // Refresh the table
        } else {
          showAlert('danger', 'Failed to save bank details');
        }
      })
      .catch(error => {
        console.error('Error saving bank details:', error);
        showAlert('danger', 'An error occurred while saving bank details');
      });
    });

    function showAlert(type, message) {
      const alertContainer = document.getElementById('alertContainer');
      alertContainer.className = `alert alert-${type}`;
      alertContainer.textContent = message;
      alertContainer.classList.remove('d-none');
      setTimeout(() => {
        alertContainer.classList.add('d-none');
      }, 5000);
    }
 //   -------------------------------------Token count --------------------------------
    document.addEventListener('DOMContentLoaded', function() {
    // Fetch the user email from session storage
    const userEmail = sessionStorage.getItem('userEmail');

    if (userEmail) {
        // Define the API endpoint to get wallet address and phone number
        const getWalletAddressUrl = `http://localhost:8080/api/admin/token/getWalletAddress?email=${encodeURIComponent(userEmail)}`;

        // Fetch wallet address and phone number
        fetch(getWalletAddressUrl)
            .then(response => response.json())
            .then(data => {
            if (data.error) {
                console.error('Error fetching wallet address and phone number:', data.error);
            } else {
                // Extract phone number and wallet address directly from the JSON response
                const phoneNumber = data.phoneNumber;
                const walletAddress = data.walletAddress;

                if (phoneNumber && walletAddress) {
                    // Fetch token count using the phone number
                    const getTokenCountUrl = `http://localhost:8080/api/admin/token/count?identifier=${encodeURIComponent(phoneNumber)}`;

                    return fetch(getTokenCountUrl);
                } else {
                    console.error('Phone number or wallet address not found in the response.');
                    throw new Error('Phone number or wallet address not found');
                }
            }
        })
            .then(response => response.json())
            .then(data => {
            if (data.tokenCount !== undefined) {
                // Update the token amount in the HTML
                document.getElementById("tokenCount").textContent = data.tokenCount;
            } else {
                console.error('Error fetching token count:', data.error);
            }
        })
            .catch(error => console.error('Error:', error));
    } else {
        console.error('User email is not found in session storage.');
    }
});
 //   -----------------------__Create Token Apis---------------------_______
document.addEventListener('DOMContentLoaded', function() {
    // Function to fetch and update the token count
    function fetchTokenCount() {
        const userEmail = sessionStorage.getItem('userEmail');

        if (userEmail) {
            const getWalletAddressUrl = `http://localhost:8080/api/admin/token/getWalletAddress?email=${encodeURIComponent(userEmail)}`;

            fetch(getWalletAddressUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error fetching wallet address:', data.error);
                    } else {
                        const phoneNumber = data.phoneNumber;
                        const walletAddress = data.walletAddress;

                        if (phoneNumber && walletAddress) {
                            const getTokenCountUrl = `http://localhost:8080/api/admin/token/count?identifier=${encodeURIComponent(phoneNumber)}`;

                            return fetch(getTokenCountUrl);
                        } else {
                            console.error('Phone number or wallet address not found in the response.');
                            throw new Error('Phone number or wallet address not found');
                        }
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.tokenCount !== undefined) {
                        document.getElementById("tokenCount").textContent = data.tokenCount;
                    } else {
                        console.error('Error fetching token count:', data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        } else {
            console.error('User email is not found in session storage.');
        }
    }

    // Handle the Create Tokens button click
    const createTokenButton = document.getElementById('createTokenButton');
    const inputAmount = document.getElementById('inputAmount');

    createTokenButton.addEventListener('click', function() {
        const amount = inputAmount.value;
        const userEmail = sessionStorage.getItem('userEmail');

        if (!userEmail) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'User email is not set in session storage.',
                confirmButtonText: 'OK'
            });
            return;
        }

        const walletAddressUrl = `http://localhost:8080/api/admin/token/getWalletAddress?email=${encodeURIComponent(userEmail)}`;

        fetch(walletAddressUrl)
            .then(response => response.json())
            .then(data => {
                const walletAddress = data.walletAddress;

                const apiUrl = 'http://localhost:8080/api/admin/token/create';
                const params = new URLSearchParams();
                params.append('walletAddress', walletAddress);
                params.append('email', userEmail);
                params.append('amount', amount);

                return fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: params.toString()
                });
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.error,
                        confirmButtonText: 'OK'
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: data.message,
                        confirmButtonText: 'OK'
                    }).then(() => {
                        // Refresh the token count
                        fetchTokenCount();

                        // Reset the input field
                        inputAmount.value = '';
                    });
                }
            })
            .catch(error => {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred while creating tokens.',
                    confirmButtonText: 'OK'
                });
                console.error('Error:', error);
            });
    });

    // Initial call to fetch token count on page load
    fetchTokenCount();
});
  </script>


</body>

</html>